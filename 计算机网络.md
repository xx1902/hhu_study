​    

# 计网体系结构

www.cnnic.net.cn

## 发展

**第一阶段**

1. ARPA（美国国防 分散的）- > APRPAnet 阿帕网
2. internet（计算机通信系统）==互联网== 希望实现不同网络互联
3. TCP/IP协议 
4. Internet ==因特网==

网络 -> 将计算机连接

互联网 -> 将网络连接

因特网 -> 最大的互联网



**第二阶段**

国家科学基金网NSFNET  

==三级结构==  主干网 -> 地区网 -> 校园网&企业网



**第三阶段** 

==多层次ISP结构==

ISP：因特网服务提供者/商 

主干ISP，地区ISP和本地ISP

IXP 因特网交换点 （直接相连） 大大提高信息传递和资源共享的速度

## 因特网概述

概述

* 网络是由如干==节点==和连接这些节点的==链路==组成

* 多个网络通过路由器互联起来， 即互联网（网络的网络）

* 因特网是世界上最大的互联网络

internet  互联网 泛指

INternet 因特网 特指

* 因特网服务提供者==ISP==
  * 因特网主干网
  * 大公司
  * 本地 只用于本地网络

**标准化**

<div style="display: flex; justify-content: space-between;">
<img src="C:/Users/17363/AppData/Roaming/Typora/typora-user-images/image-20240314150445784.png" alt="图片描述" width="500" height="300">
<img src=>
</div>



**因特网组成**

* 边缘部分  连在因特网上的主机  **用户直接使用** 用来进行**通信**和**资源共享**
* 核心部分  由**大量网络**和连接这些网络的**路由器**组成，**为边缘部分提供服务**



## 三种交换方式

**电路交换**

电话交换机接通电话线的方式称为电路交换

从通讯资源的分配角度来看，交换就是按照某种方式动态的分配传输线路的资源

**步骤**

* 建立连接（分配通信资源）
* 通话（一直占用通信资源）
* 释放连接（归还通信资源）

**比特流直达终点**   1. 时延小   2.有序传输   3.没有冲突   4.适用范围广   5.实时性强   6.控制简单

缺点 1.建立连接时间长   2.线路独占，使用效率低   3.灵活性差   4.难以规则化



**分组交换** 

* 发送方 构造分组 （头部地址） 发送分组
* 路由器 缓存分组 转发分组
* 接收方 接收分组 换元报文

分组在各节点的交换机上进行存储转发， **减少了转发时延**，**避免过长的报文长时间占用链路**，**有利于进行差错控制**

1.无需建立连接   2.线路利用路高  3.简化了存储管理  4.加速传输   5.减少出错概率和从发数据量

缺点：1.引发了转发时延  2.需要传输额外的信息量 3.存在丢失等问题

若采用虚电路服务，存在呼叫建立、数据传输和虚电路释放过程



**报文交换** 

和分组交换相同 ， 对报文的大小没有限制， 借还节点要有较大的缓存空间



## 计网络定义和分类

四网融合 计算机网络（互联网）、电信网络（电话）、有限电视网络（广播电视网）、[电网 （路灯等）]

计算机网络：是一个将分散的、具有独立功能的==计算机系统==，通过==通讯设备==与==线路==连接起来，由功能完善的==软件==实现==**资源共享**==和==**信息传递**==

计算机网络是==互联==的、==自治==的计算机**集合**

`互联` 通过通讯链路互联互通 - > 计算机之间可以通过有限或无线的方式进行数据通信

`自治` 无主从关系  - > 独立的计算机，有自己的硬件和软件，可以单独运行

` 集合`  至少两台计算机

1. 数据通讯
2. 资源共享

  * 硬件 - > wifi打印机(配置固定的IP)
  * 软件 - > 远程访问电脑
  * 数据 - > 百度网盘 

3. 分布式处理   多台计算机各自承担同一工作任务的不同部分 - > Hadoop平台
  4. 提高可靠性  替代机
  5. 负载均衡



**计算机网络的分类**

* 按照交换技术  电路交换 报文交换 分组交换
* 按照使用者  公用网 专用网
* 按照传输介质   有线网络  无线网络 
* 按照覆盖范围   广域网WAN  城域网MAN  局域网LAN  个域网PAN
* 按照拓扑结构  总线型 星型 环形 网状型



## 性能指标

* **速率**
  * bit 数据量单位   8bit = 1Byte   
  * kB = 2^10^B   MB = 2^20^B  GB = 2^30^B  TB = 2^40^B
  * 速率：连接在计算机网络上的主机在数字信道上传送比特的速率，也称为**比特率或数据率**
  * kb/s = 10^3^b/s   Mb/s = 10^6^b/s    Gb/s = 10^9^b/s    Tb/s = 10^12^b/s      bit/s(b/s,bps)
  * <img src="C:/Users/17363/AppData/Roaming/Typora/typora-user-images/image-20240417081406084.png" alt="image-20240417081406084" style="zoom: 33%;" />

* **带宽**
  * 在**模拟信号系统**中的意义：信号所包含的各种不同频率成分所占据的频率范围 单位 Hz
  * 在**计算机网络中**的意义：用来表示网络的通信线路所能**传送数据的能力**，因此网络带宽表示在单位时间内从网络中的某一点到另一点所能通过的“==最高数据率==”;
  * 单位：b/s (kb/s,Mb/s,Gb/s,Tb/s)
  * “带宽”的这两种表述之间有着密切的联系，一条通信线路的“频带宽度”越宽,其所传输数据的“最高数据率”也越高。
* **吞吐量**
  * 吞吐量表示在==单位时间内==通过某个网络(或信道、接口)的**数据量**
  * 吞吐量被经常用于对现实世界中的网络的一种测量，以便知道**实际上**到底有多少数据量能够通过网络
  * 吞吐量受**网络的带宽或额定速率的限制**
* **时延**
  * 发送时延：主机将分组发送给线路    ` 分组长度（b）/ 发送速率（b/s）`
  * 传播时延：代表分组的电信号在线路上传输  `信道长度（m）/ 电磁波传播速率（m/s）` 
    * 自由空间：3×10^8^ m/s	铜线：2.3×10^8^ m/s	光纤：2.0×10^8^ m/s
  * 处理时延：路由器收到分组后对其进行分组转发 （一般不便于计算）
  * <img src="C:/Users/17363/AppData/Roaming/Typora/typora-user-images/image-20240417084804944.png" alt="image-20240417084804944" style="zoom: 33%;" />
* 时延带宽积
  * 传播时延 × 带宽
  * 若发送端连续发送数据，则在所发送的第一个比特即将到达终点时发送端就已经发送了时延带宽积个比特
  * 链路的时延带宽积又称为==以比特为单位的链路长度==
* 往返时间（RTT）
  * 双向交互一次所需的时间（因特网上的信息往往是双向交互）
  * <img src="C:/Users/17363/AppData/Roaming/Typora/typora-user-images/image-20240417085306452.png" alt="image-20240417085306452" style="zoom: 33%;" />
* 利用率
  * 信道利用率  用来表示某信道有百分之几的时间是被利用的(有数据通过)
  * 网络利用率  全网络的信道利用率的加权平均
  * 根据排队论，当某信道的利用率增大时，该信道引起的时延也会迅速增加，信道利用率==并非越高越好==;
  * <img src="C:/Users/17363/AppData/Roaming/Typora/typora-user-images/image-20240417085722747.png" alt="image-20240417085722747" style="zoom: 33%;" />

* 丢包率
  * 丢包率即分组丢失率，是指在一定的时间范围内，传输过程中**丢失的分组数量与总分组数量的比率**
  * 丢包率具体可分为接口丢包率、结点丢包率、链路丢包率、路径丢包率、网络丢包率等
  * 丢包率是网络运维人员非常关心的一个网络性能指标
  * 分组丢失的两个主要原因:**分组误码**，结点交换机缓存队列满(**网络拥塞)**;
  * <img src="C:/Users/17363/AppData/Roaming/Typora/typora-user-images/image-20240417085945461.png" alt="image-20240417085945461" style="zoom:33%;" />



## 体系结构

OSI体系结构（开放系统互联参考模型）和 TCP/IP体系结构

<div style="display: flex; justify-content: space-between;">
<img src="C:/Users/17363/AppData/Roaming/Typora/typora-user-images/image-20240417091159808.png"  style=" margin: 10px;" width = 500 height = 300>
<img src="C:/Users/17363/AppData/Roaming/Typora/typora-user-images/image-20240417091049497.png"  style=" margin: 10px;" width = 500 height = 300>
</div>
**分层的必要性**

* 物理层
  * 解决使用何种信号来传输比特的问题
* 数据链路层
  * 解决分组在**一个网络(或一段链路)上传输**的问题
* 网络层
  * 解决分组在**多个网络上传输**(路由)的问题
* 运输层
  * 解决进程之间基于网络的通信问题
* 应用层
  * 解决通过应用进程的交互来实现特定网络应用的问题



<img src="C:/Users/17363/AppData/Roaming/Typora/typora-user-images/image-20240417093144677.png"  style=" margin: 10px;" width = 500 height = 300>



**专用术语**

实体

* 实体：任何可发送或接收信息的硬件或软件进程
* 对等实体：收发双方相同层次中的实体（通信双方的网卡，通讯双方中正在进行通讯的应用程序

协议

* 协议：控制两个对等实体进行**逻辑通信**的规则的集合 （通讯实际不存在，方便单独研究某一层）
* 运输层：使用运输层协议(例如TCP, UDP)进行通信
* 三要素
  * 语法：定义所交换信息的格式
  * 语义：定义收发双方所要完成的操作
  * 同步：定义收发双方的时序关系

服务

* 在协议的控制下，两个对等实体的通讯





# 物理层





# 上课

## 数据链路层

* 点到点的链路     [PPP协议 （点对点的协议）](https://blog.csdn.net/weixin_74021557/article/details/131379766)

  * 封装成帧， [透明传输](https://blog.csdn.net/weixin_74021557/article/details/131379766)
  * 零比特填充  逢五个1加一个0
* 广播链路-总线型 
* [局域网的拓扑](https://worktile.com/blog/know-1253/)
  * 星型网    以太网
  * 环形网    令牌环   
  * 总线网    以太网    令牌总线
  * 树形网  
  

### 计算机局域网标准

[IEEE802  参考模型](https://cloud.tencent.com/developer/article/1641479)

将数据链路层化为两层

* 逻辑电路控制子层 LLC
  * 数据链路层与媒体接入无关的部分
* 媒体访问控制子层 MAC
  * 与接入各种传输媒体有关的问题

>数据链路层负责把不可靠的传输信道转换成可靠的传输信道，采用差错控制和帧确认技术传送带有校验的数据帧。其中，LLC子层的功能包括:数据帧的组装与拆卸、帧的收发、差错控制、流量控制和发送顺序控制等功能，并为网络层提供面向连接和无连接两种类型的服务;MAC子层的主要功能是进行合理的信道分配，解决共享信道的竞争问题，还要负责把物理层的0、1比特流组建成帧，并实现帧的寻址和识别，以及产生帧检验序列和完成帧检验等功能。

### 网卡~网络接口卡~

计算机通过网卡和局域网进行通讯

又称==通讯适配器==， 每个适配器都会**固化**一个MAC地址，用来表示该适配器代表的接口

* 对数据进行缓存
* **实现MAC层协议**  不同局域网的差异 
* 进行串行/并行转换

[MAC地址](https://baijiahao.baidu.com/s?id=1679232588455461319&wfr=spider&for=pc)

MAC子层基本工作过程

* 发送数据  接收上层PDU、组装成数据帧、竞争总线、发送数据帧
* 接收数据 从物理层的比特流中识别数据帧到缓冲区、数据帧检错、是否为本机接收（通过MAC地址判断）、发送给本机的帧的数据部分给上层协议模块（如IP)



### 局域网的三个关键技术

* 网络拓扑
* 传输介质
* 介质访问控制方法

> **以太网提供的服务**是不可靠的交付，即尽最大努力的交付
>
> 差错的纠正由高层来决定
>
> 高层发现丢失的数据会进行重传，以太网并不知道这是一个重传的帧，而是当做一个新的数据帧来发送

* 以太网采取无连接的工作方式，对发送的数据帧不进行编号 原因：局域网的通信信道质量好

### 共享式以太网的工作原理

采用“竞争”策略来获得信道 

称作 载波监听多路访问/冲突检测协议 简写CSMA/CD

* 先听后发  发前先监听方式信道是否有信息在传递。线路忙，继续监听、线路不忙，立即发送
* 边听边发  （碰撞检测/冲突检查）等于任意两个站之间最大传播时延的两倍
* 冲突停止  发生冲突立即停止
* 延迟重发  1.随机策略 2.采用二进制退避算法BEB延迟重发

[MAC地址和MAC帧的格式](https://blog.csdn.net/nytcjsjboss/article/details/130491162)

缺点

* 共享同一冲突域，不能同时工作
* 共享同一带宽，传输效率低
* 采用广播形式，容易造成广播风暴，而且不安全

### 交换式以太网（星型拓扑）

* 以数据链路层的帧为数据交换单位，以以太网交换机为基础构成的网络
* 允许许多对节点同时通信，每个节点独占传输通道和带宽，根本上解决了共享以太网所带来的问题
* 以太网交换机工作在链路层

### 交换机工作原理

* 每个交换机内部维护一张**地址映射表**
* 地址映射表（交换表）：记录交换机上每个端口连接主机的MAC地址信息

* 功能
  * 地址表的学习：建立地址映射表
  * 帧的转发和过滤：采用“**储存转发**" 进行数据交换
  * 避免回路
* 特点
  * 共享式 均分带宽
  * 交换式 独占信道

### 交换机与集线器的区别

* 集线器属于物理层设备， 交换机属于数据链路层设备（能从bit流识别出数据帧，并从中提取地址）， 中继器也属于物理层
* 集线器是一种广播模式， 交换机是端口和端口之间
* 集线器共享一条带宽， 交换机每个端口都有独占的带宽



## 局域网

### 令牌环网

1. 令牌，拥有令牌发送数据
2. 数据帧绕一圈回到源点
3. 每个节点拥有令牌时间有限
4. 令牌服务器产生令牌
5. 令牌中可以加优先级 

### 令牌总线网

1. 有一个表 前者和后者
2. 将令牌帧的目标地址改为后者

### 扩展局域网

 用多个集线器可以连接成更大的局域网

组网中普遍采用三层结构模型

* 核心层  高数数据转发
* 汇聚层  负责路由聚合及流量控制
* 接入层  向工作层接入网络

### 如何避免环路

**生成树算法**  网络拓扑与对应的生成树

### 使用网桥在数据链路层扩展局域网

网桥

* 地址学习：采用逆向学习
* 数据帧转发：看源端口网络类型和目标端口网络类型是否相同，不同需要进行数据帧的交换     



## 网络层

> 实现网络互连，进而实现数据报在各个网络之间的传输

**虚电路服务**

1. 建立虚电路  发送一个特定格式的控制信息分组，要求进行通信，同时寻找一条合适路由。若对方同意则发回响应
2. 之后的通信都用这条链路
3. 完成通信后 取消虚电路

**数据报服务**

* 网络随机接收主机发送的分组（数据报）
* 网络为每个分组独立的选择路由进行转发

* 网络进最大努力将分组交给目的主机（不可靠的的服务）
  * 网络不保证所传送的分组不丢失
  * 补保证按源主机发送分组的先后顺序
  * 以及在时限内必须将分组交付给目的主机



网络层的协议

* 国际协议  IP  分类编制 -> 划分子网 -> 无分类编辑
  * 常用的三种类别的IP地址
    * A 1 - 126
    * B 128.1 - 191.255
    * C 192.0.1 - 223.255.255
  * 私有地址
    * 10.0.0.0 - 10.255.255.255
    * 172.16.0.0 - 172.31.255.255
    * 192.168.0.0 - 192.168.255.255
  * 重要特点
    * IP地址是分级的地址结构
    * IP地址是标志一个主机（或路由器）和一条链路的路口
* 地址解析协议  ARP
* 逆地址解析协议 RARP
* 网路控制报文协议 ICMP
* 网络组织管理协议 IGMP



网络层的路由选择

* 最佳路径的判定
* 网间信息的传送
* 选择策略
  * 静态路由选择策略
  * 固定路由选择策略
  * 随机路由选择策略
  * 动态路由选择策略
    * 路由器能够感知最临近路由的状况
    * 定时与最临近的路由交换信息

路由表

* 目标IP地址 目标IP地址是 目标主机、子网地址、网络地址或默认路由  0 0 0 0 
* 网络掩码  与目标地址位置结合使用以决定路由的时间
* 网关  

路由器

* 具有多输入端口和多输出端口的专用计算机
* 路由选择 根据给定的路由选择协议构造出路由表，经常或定期和相邻的路由表由信心而不断更新和维护路由表，其服务对象是网络 
* 分组转发 转发仅涉及到一个路由器，其服务对象是分组
* 可以运行多种动态路由协议，每一种动态路由协议都建立自己的路由表

转发表



子网划分

* 优点
  * 提高IP地址利用率
  * 便于网络管理
  * 减少网络流量，提高网络性能
* 基本思路
  * 划分子网是一个单位的内部的事情，对外仍然表现出没有划分子网的网络
  * 从主机号借用若干个比特作为子网号subnet-id 而主机号host-id 也就相应减少了若干个比特

子网掩码

* 从一个IP地址无法判断其所在的网络是否进行了子网的划分





超网（子网汇聚）

IP地址被分为 独立的网络地址和主机地址

超网是将一些小网络组合成一个大网络 相当于子网划分的逆运算



最长前缀匹配



ip数据报

* ip数据报分片和重组
  * 以太网 1500字节最大MTU -> 网络规定一个镇最多能够携带的数据量（与网络连接的各个路由器的MTU可能不同）
    * 以太网 1500字节
  * ip数据报的大小往往大于将发往网络的MTU值， 路由器将ip数据报部分分成若干较小的部分的过程，都有头部信息
  * 分片后 两点不同  标志和片位移 
    * 标志 -> 三位二进制数表示 --- 未使用 -- 不分片DF -- 片未完MF---
      * MF 1表示还有后续分片 0表示最后一个分片
      * DF 1表示不分片  若大于此网络的MTU会被网络抛弃
    * 片偏移 -> 在原来的ip数据区的位置 用 13位片偏移表示 （分片多次  都是相当于主报文的位置）
    * MF=0时，可以计算报文的大小
    * IP头部20字节  要算上
  * 重组 
    * 在收到所有分片的基础上，主机对分片进行重组 
    *  路由器为分片独立选路，不进行重组



ip分组交付

* 直接分组
  * 目的主机和源主机在同一网络，或者在最后一个路由器与目的主机之间将直接交付
* 简介分组
  * 目的主机和源主机不在同一网络，或者路由器没有和目标主机连接在同一个网络
* ARP -> 基于ip地址解析MAC地址
* DNS -> 解析域名 交换机有网卡 路由有网卡



分层次的路由选择协议

* 自治系统AG
* 内部网关协议 IGP 
  * RIP 
    * 分布式的距离网关协议（最短路径）
    * 一条路径最多为15个路由器  16表示不可达
    * 仅仅和相邻的路由器交换信息，交换的是本路由器的全部信息，按固定时间间隔交换路由信息
  * OSPF
    * “开放” 是公开发表的
    * “最短路径有限”
    * 所有的OSPF路由器都拥有网络中所有的链路状态
    * 邻居  和 邻接（是邻居 并且 能交换 LSA）
* 外部网关协议 EGP
  * BGP-4



路由器的收敛机制

外部网关协议

* BGP是不同自治系统的路由器之间交换路由信息的协议
* BGP只是立秋寻找一条能够到达目的网络切比较好的路由，并非要寻找一条最优的路径
* 寻找路径：在不同的AS之间交换可达的信息



IP协议缺点

* 没有差错报告或者差错纠正机制
* 缺少主机和管理查询所需要的机制

因特网控制消息协议 ICMP

* 用于在主机、路由器之间传递控制信息。控制信息是指网络不通、主机是否可达、路由是否可用等网咯本身的消息

* 差错报告报文： 报告 路由器或者主机在处理IP数据包时 可能 遇到的问题
  * 特点
    * 路由器或者目的主机抛弃数据报
* 查询报文：总是成双成对出现，他帮助主机或者网络管理员从某个路由器或者对方主机里获取特定的信息



IPV6

* 冒分十六进制表示法
  * 格式为**X:X:X:X:X:X:X:X**，其中每个X表示地址中的16b，以十六进制表示，例如：**ABCD:EF01:2345:6789:ABCD:EF01:2345:6789**
  * 这种表示法中，每个X的前导0是可以省略的，例如：**2001:0DB8:0000:0023:0008:0800:200C:417A****→ **2001:DB8:0:23:8:800:200C:417A**

* 0位要锁省略法

  * 在某些情况下，一个IPv6地址中间可能包含很长的一段0，可以把连续的一段0压缩为“：：”。但为保证地址解析的唯一性，地址中“：：”只能出现一次，例如：

    **FF01:0:0:0:0:0:0:1101 → FF01::1101
     　0:0:0:0:0:0:0:1 → ::1
     　0:0:0:0:0:0:0:0 → ::**

* 内嵌IPv4地址表示法







## 传输层

> 传输层起着衔接上下三层的作用   资源子网  通信子网
>
> 要解决的问题：
>
> * 互联网中进程的标识和交互模式
> * 向上层提供的服务（可靠or不可靠）



网络环境中  进程标识（三元组）

* 主机地址
* 进程端口
* 进程使用的传输层协议（TCP/UDP）



进程端口：

